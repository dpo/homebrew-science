language: ruby
matrix:
  include:
    - env: OSX=10.11
      os: osx
      osx_image: xcode8
      rvm: system
    - os: linux
      rvm: system
      sudo: required

addons:
  apt_packages:
    - build-essential
    - curl
    - git
    - python-setuptools
    - m4
    - texinfo
    - libblas-dev
    - liblapack-dev

before_install:
  - if [ -f ".git/shallow" ]; then
      travis_retry git fetch --unshallow;
    fi
  - if [ "${TRAVIS_OS_NAME}" = "osx" ]; then
      sudo chown -R "$USER" "$(brew --repo)";
    else
      echo -ne '\n' | ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Linuxbrew/install/master/install)";
      export PATH="$HOME/.linuxbrew/bin:$PATH";
    fi
  - git -C "$(brew --repo)" reset --hard origin/master;
  - git -C "$(brew --repo)" clean -qxdff;
  - brew update || brew update;
  - mkdir -p "$(brew --repo)/Library/Taps/homebrew";
  - ln -s "$TRAVIS_BUILD_DIR" "$(brew --repo)/Library/Taps/homebrew/homebrew-science";
  - cd "$(brew --repo)/Library/Taps/homebrew/homebrew-science";
  - for tap in homebrew/python homebrew/x11 homebrew/dupes homebrew/versions; do brew tap $tap; done;
  - export TRAVIS_BUILD_DIR="$(brew --repo)/Library/Taps/homebrew/homebrew-science";
  - env | grep TRAVIS | tee /tmp/travis.env

install:
  - export HOMEBREW_DEVELOPER="1"
  - ulimit -n 1024

script:
  - brew test-bot --tap=homebrew/science;

notifications:
  email:
    on_success: never
    on_failure: never
